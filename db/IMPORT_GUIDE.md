# –ò–º–ø–æ—Ä—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ CSV –≤ Supabase

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç ~149K —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ CSV —Ñ–∞–π–ª–∞ `povarenok_recipes_2021_06_16.csv` –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É Supabase.

## üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase SQL Editor:
# 1. db/migrate_add_normalized_schema.sql
# 2. db/seed_units.sql
# 3. db/smoke_check.sql
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

**–ì–¥–µ –Ω–∞–π—Ç–∏ –∫–ª—é—á–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Supabase Dashboard
2. Settings ‚Üí API
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - Project URL ‚Üí `NEXT_PUBLIC_SUPABASE_URL`
   - service_role key (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π) ‚Üí `SUPABASE_SERVICE_ROLE_KEY`

‚ö†Ô∏è **–í–ê–ñ–ù–û**: service_role key –æ–±—Ö–æ–¥–∏—Ç RLS! –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –µ–≥–æ –≤ Git!

### 3. –†–∞—Å–ø–∞–∫—É–π—Ç–µ CSV —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–µ —Å–¥–µ–ª–∞–ª–∏ —Ä–∞–Ω–µ–µ)

```bash
cd /Users/alex/Documents/receip/References
unzip povarenok_recipes_2021_06_16.csv.zip
```

## üöÄ –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ npm script (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /Users/alex/Documents/receip/mealapp
npm run import:recipes
```

### –°–ø–æ—Å–æ–± 2: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ tsx

```bash
cd /Users/alex/Documents/receip/mealapp
npx tsx db/import_recipes.ts
```

## ‚è±Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤**: ~149,000
- **–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è**: 30-60 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–µ—Ç–∏ –∏ Supabase)
- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~50-100 —Ä–µ—Ü–µ–ø—Ç–æ–≤/—Å–µ–∫

## üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏–∑ –ë–î
2. ‚úÖ –ß–∏—Ç–∞–µ—Ç CSV —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
3. ‚úÖ –ü–∞—Ä—Å–∏—Ç Python dict —Ñ–æ—Ä–º–∞—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
4. ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞:
   - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `recipes`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏ –ø–∞—Ä—Å–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ/–µ–¥–∏–Ω–∏—Ü—ã
   - –°–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `ingredients`
   - –°–æ–∑–¥–∞—ë—Ç —Å–≤—è–∑–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `recipe_ingredients`
5. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ URL)
6. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 1000 —Ä–µ—Ü–µ–ø—Ç–æ–≤

## üîç –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### CSV —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```csv
url,name,ingredients
https://www.povarenok.ru/recipes/show/164365/,–ì—É—Å—Ç–æ–π –º–æ–ª–æ—á–Ω–æ-–∫–ª—É–±–Ω–∏—á–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å,"{'–ú–æ–ª–æ–∫–æ': '250 –º–ª', '–ö–ª—É–±–Ω–∏–∫–∞': '200 –≥', '–°–∞—Ö–∞—Ä': '15 –≥'}"
```

### –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤

–°–∫—Ä–∏–ø—Ç —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å:
- **–ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**: "250 –º–ª", "200 –≥", "15 –≥"
- **–¢–µ–∫—Å—Ç–æ–≤—ã–µ**: "–ø–æ –≤–∫—É—Å—É", "—â–µ–ø–æ—Ç–∫–∞"
- **–ë–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞**: `None` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `null`

### –ú–∞–ø–ø–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü

| –†—É—Å—Å–∫–∏–π | –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ |
|---------|-----|----------|
| –≥, –≥—Ä, –≥—Ä–∞–º–º | `g` | –≥ |
| –º–ª, –º–∏–ª–ª–∏–ª–∏—Ç—Ä | `ml` | –º–ª |
| –∫–≥, –∫–∏–ª–æ–≥—Ä–∞–º–º | `kg` | –∫–≥ |
| —à—Ç, —à—Ç—É–∫ | `pcs` | —à—Ç |
| —á.–ª., —á–∞–π–Ω. –ª–æ–∂. | `tsp` | —á.–ª. |
| —Å—Ç.–ª., —Å—Ç–æ–ª. –ª–æ–∂. | `tbsp` | —Å—Ç.–ª. |
| —â–µ–ø–æ—Ç–∫–∞ | `pinch` | —â–µ–ø–æ—Ç–∫–∞ |
| –∑—É–±., –∑—É–±—á–∏–∫ | `clove` | –∑—É–±—á–∏–∫ |
| –ø—É—á., –ø—É—á–æ–∫ | `bunch` | –ø—É—á–æ–∫ |

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 1000 —Ä–µ—Ü–µ–ø—Ç–æ–≤:

```
üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 5000 | –ü—Ä–æ–ø—É—â–µ–Ω–æ: 12 | –û—à–∏–±–æ–∫: 3 | –°–∫–æ—Ä–æ—Å—Ç—å: 85.2 —Ä–µ—Ü/—Å–µ–∫ | ETA: 28 –º–∏–Ω
```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (—Å–º. –≤—ã—à–µ)

### –û—à–∏–±–∫–∞: "CSV —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ**: –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤:
```bash
cd /Users/alex/Documents/receip/References
unzip povarenok_recipes_2021_06_16.csv.zip
```

### –û—à–∏–±–∫–∞: "Permission denied" –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Supabase
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `SUPABASE_SERVICE_ROLE_KEY` (–Ω–µ anon key)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—Å—Ç–∞–≤–∫—É

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ (<10 —Ä–µ—Ü/—Å–µ–∫)
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- Supabase –≤ Free tier –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ú–Ω–æ–≥–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á—å—Ç–µ `BATCH_SIZE` –≤ —Å–∫—Ä–∏–ø—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø–µ—Ä–≤—ã–µ 100 —Ä–µ—Ü–µ–ø—Ç–æ–≤)

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∞:

```typescript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ importRecipes() –¥–æ–±–∞–≤—å—Ç–µ:
if (processedRecipes >= 100) {
  console.log('\n‚ö†Ô∏è  –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Å–ª–µ 100 —Ä–µ—Ü–µ–ø—Ç–æ–≤');
  break;
}
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
    'IMPORT RESULTS' as status,
    (SELECT COUNT(*) FROM recipes) as total_recipes,
    (SELECT COUNT(*) FROM ingredients) as total_ingredients,
    (SELECT COUNT(*) FROM recipe_ingredients) as total_recipe_ingredients;

-- –ü—Ä–∏–º–µ—Ä—ã —Ä–µ—Ü–µ–ø—Ç–æ–≤
SELECT id, name, url, base_servings
FROM recipes
ORDER BY id
LIMIT 10;

-- –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
SELECT 
    i.name,
    COUNT(*) as recipe_count
FROM ingredients i
JOIN recipe_ingredients ri ON ri.ingredient_id = i.id
GROUP BY i.id, i.name
ORDER BY recipe_count DESC
LIMIT 20;

-- –†–µ—Ü–µ–ø—Ç —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏ (–ø—Ä–∏–º–µ—Ä)
SELECT 
    r.name as recipe_name,
    i.name as ingredient,
    ri.amount,
    u.name_ru as unit,
    ri.amount_text
FROM recipes r
JOIN recipe_ingredients ri ON ri.recipe_id = r.id
JOIN ingredients i ON i.id = ri.ingredient_id
LEFT JOIN units u ON u.id = ri.unit_id
WHERE r.id = 1
ORDER BY ri.sort_order;
```

## üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫

–°–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:
- –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
- –ú–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å Ctrl+C –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ)

```sql
-- –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
BEGIN;

DELETE FROM recipe_ingredients;
DELETE FROM recipes;
DELETE FROM ingredients;
-- units –Ω–µ —É–¥–∞–ª—è–µ–º, –æ–Ω–∏ –∏–∑ seed_units.sql

COMMIT;
```

## üìû –ü–æ–º–æ—â—å

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (`db/smoke_check.sql` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚úì ALL CHECKS PASSED)
2. ‚úÖ CSV —Ñ–∞–π–ª —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `References/`
3. ‚úÖ `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ Supabase
4. ‚úÖ Service role key –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–µ anon key)
5. ‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ
